原文链接： https://github.com/bitshares/bsips/blob/master/bsip-0021.md
译者： bt666

    BSIP:# 021
    标题:介绍比特股资产的“币龄”统计数据
    作者:[Customminer](https://steemit.com/@cm-steem)
    状态:草案
    类型:协议
    创建:2017-07-03
    主要讨论:https://steemit.com/bitshares/@cm-steem/bsip-020-draft-introducing-profit-sharing-dividends-to-bitshares-uia-only-input-would-be-massively-appreciated
    类似的讨论:N / A
    替换:N / A
    取代:
    预算提案:N / A

## 摘要 ##

介绍了如何在BTS DEX上查询个人持有资产的“币龄”。

## 动机 ##

- 比特股网络中不存在可直接查询的“币龄”统计数据。
- 目前，在客户端中查询帐户最接近累计资产币龄的方法是查询帐户的交易历史记录，然后使用外部脚本来计算币龄。
- 目前还没有任何用于计算用户资产币龄的开源脚本。

## 基本原理 ##

- BSIPs19和20(介绍了MPA(19)/UIA(20)的利益共享/分红)都引用了一个不存在的“币龄”统计数据。
- 建议在发放分红期间内，根据资产在用户余额中所占的时间长短，按比例分配利润/分红，以防止滥用定期的分红。
- 我们经历过由公开的定期快照引起的市场波动/不稳定(用户在快照之前立即购买，快照之后立即出售);通过在分红机制中加入“币龄”来阻止类似做法，可能有助于解决这一问题。
- 关于共识，还没有充分讨论让用户表达对币龄提案的异议。
- 一个合理的担忧是，如果有大量的资产持有者和需要处理的交易，那么为所有用户评估accumulated_coin_age的计算成本可能会很高。
- 该BSIP所涉及的币龄问题是，如果代币的持有时间超过了用户指定的time_period，那么这些代币的意义就超过了本身(如果持有时间比用户输入时间长2倍，那么1个就等于2个)。

## 详情 ##

- 对于过去转账给用户的特定资产的每个块，可以方便地查询/计算每个用户累积的“币龄”统计数据。
- 可能的途径:
	- 检索持有选定资产的帐户列表
	- 有了这个列表，查询账户的流动资产持有量(对于选择的资产)，返回组成持有量的交易列表。
	- 评估每个合格资产持有人的tx列表中的币龄。
- 币龄计算草案:(伪代码的示例，而不是生产代码!)


    let reference_asset = USD; //用户输入变量
    let time_period = 30 days; //用户输入变量
    let accumulated_coin_age = 0;
    let reference_time = current_time; //用户输入变量
    
    if (whitelisted_accounts) {
    let eligible_asset_holders = whitelisted_accounts //用户输入的白名单
    } else if (blacklisted_accounts) {
    let eligible_asset_holders = asset_holder_list - blacklisted_account_list //用户输入的黑名单
    } else {
    let eligible_asset_holders = asset_holder_list //包括所有资产持有者
    }
    
    for each asset_holder in eligible_asset_holders  {
    for each tx in asset_holdings {
    let tx_balance = current_tx_balance //得到这次交易中的代币数量
    let time_diff = current_date - tx_inbound_date //获取交易时长
    
    if (time_diff > time_period) {
    accumulated_coin_age += tx_balance //如果持有时间超过time_period，则防止代币继续增值。 增加time_period来实现此功能。
    Increase time_period to provide this functionality.
    } else {
    accumulated_coin_age += ((time_diff/time_period)*tx_balance)
    }
    }
    //在[hashmap|storage]中存储当前的asset_holder & accumulated_coin_age，以供以后引用
    }

- 基于币龄的个人用户分红的计算:

    if (whitelisted_accounts) {
    let total_eligible_token_supply = assets_held_by_whitelisted_accounts
    } else if (blacklisted_accounts) {
    let total_eligible_token_supply = total_supply - assets_held_by_blacklisted_accounts
    } else {
    let total_eligible_token_supply = total_supply
    }
    
    let total_distributable_tokens = 1000 OPEN.GRC; //quantity & token type set by user
    
    for each asset_holder in coin_age_hashmap {
    dividend_allocation = (accumulated_coin_age/total_eligible_token_supply)*total_distributable_tokens
    } 

## 讨论 ##

### 如何使用币龄预防BSIPs 19和20的滥用? ###

- 如果我们要基于即时账户持有的静态快照来发放定期的分红，用户可以在发放分红之前立即购买资产，收到分红后立即售出，这可能会导致定期分红周围的市场不稳定/波动。
- 我们在过去经历过这种形式的市场不稳定，包括protoshares(过去的sharedrops)和BTS(peerplays)。(提前买入后立即卖出，定期分红造成市场的不稳定)。

### “币龄”的潜在替代品，以防止滥用分红制度 ###

- 在股投期间内随机的快照日期(类似于peerplay在可能的快照时间范围内的秘密快照日期)。
- 缺点:在快照时间段内保留快照时刻的资产不符合获得分红的资格。
- 在定期的股投期间增加市场手续费?如果UIA开启了额外手续费的市场，溢价费用可能会潜在地鼓励用户在月初购买资产&提供长期资产持有人额外的利润?只有UIA才有可能，MPA不可能。
- 在分红期间禁止市场交易?这将是难以置信的沉重之举，可能会令资产持有者感到恐慌，尤其是如果资产价格在外部交易所波动的话。
- 完全无视分红制度滥用的担忧?Openledger目前执行定期股投给Obits持有人，而不考虑币龄问题！

## 股东总结 ##

- 这不会对股东造成影响，只会在比特股网络中提供一个额外的可查询统计数据，以便在BSIPs 19和20中提供更多的功能。
- 目前还没有预算提案或赏金提案，只是在社区内集思广益！
- 将在以后的BeyondBitcoin群聊中讨论/提及。

## 版权 ##

本文档放置于公共域名下。

## 查看 ##

- [列出帐户余额-石墨烯文档](http://docs.bitshares.org/api/database.html#id8)
- [BSIP 21 Steemit系列](https://steemit.com/bitshares/@cm-steem/bsip-0021-draft-introducing-the-coin-age-statistic-to-bitshares-assets-input-would-be-massively-appreciated)


