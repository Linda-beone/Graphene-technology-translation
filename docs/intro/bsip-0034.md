原文链接：https://github.com/bitshares/bsips/blob/master/bsip-0034.md
译者：bt666

    BSIP:0034
    标题:当追加价格高于或处于喂价时，总是触发追加保证金
    作者:Abit More <https://github.com/abitmore>
    状态:安装
    类型:协议
    创建:2018-02-18
    讨论:https://github.com/bitshares/bitshares-core/issues/606
    替换:-
    预算提案:1.14.95

## 摘要 ##

目前，在比特股中，只有当满足这两项要求时，空头头寸才可能用于追加保证金:

- 追加价格高于或处于平均喂价
- 账本上没有限价单是以高于空头头寸的追加价格买入抵押的

这种机制使得市场参与者感到困惑和愤怒。

该BSIP提出了一种新的方法来改善这种情况:放弃第二个要求，在满足第一个要求时触发追加保证金。

## 动机 ##

为了避免含糊不清，在本文中，所有价格都是以债务资产/抵押品资产的形式计算的，即每一项抵押资产的债务资产数量。出价是用债务资产购买抵押资产的订单。

通常，当一个空头头寸的抵押比率低于或等于维持抵押比率(MCR)时，就可用于追加保证金。

然而，要计算抵押比率，需要一个公平的抵押价格。

在比特股中，有两个数据源可以用来确定公平的抵押价格:

- 内盘市场
- 喂价

目前，这两个数据源都被使用。具体来说，抵押价格是指内盘市场的最高出价与中位的喂价之间的较高价格。也就是说,当据平均喂价，一个空头头寸的抵押比率已降至低于或等于MCR(在这种情况下,空头头寸的追加价格高于或等于平均喂价),如果市场上有报价更高的价格，空头头寸不能用于追加保证金。

这种机制使得市场参与者感到困惑和愤怒。

- 账本上经常有价格重叠而又没有成交的订单
- 经常有空头头寸以较低的价格出售抵押，但交易人员无法以这些价格买进
- 当借款人有机会以更高的价格出售抵押时，它往往会导致借款人以低价出售这些抵押
- 市场操纵者/套利交易者有更多的机会迫使借款人以更低的价格出售抵押

该方案有效地提出了一种新的机制:仅从喂价中获得公平的抵押价格。

## 基本原理 ##

由于喂价是由一组选定的生产者提供的，因此平均喂价通常被认为是可信的。另一方面，即时市场价格不那么可靠，特别是对于深度较差的市场而言，因此对于计算抵押价格来说是一个相当有限的补充。

此时，将规则更改为只使用平均喂价将消除最终用户可能有的困惑，同时在一定程度上保持衍生的抵押价格的公平性。

完成此更改后,下一个新的限价单将不再触发追加保证金,取消限价单或到期限价单也不会触发追加保证金,这意味着我们不需要在这些场景中检查新追加保证金和黑天鹅事件,因此可以提高性能。

## 详情 ##

在数据库类的check_call_orders(…)函数中，当将追加单与限价单匹配时，会有一个检查:if(match_price > ~call_itr->call_price)，当结果为true时，运行结束并返回margin_calls。需要跳过检查以及以下返回操作。

在limit_order_cancel_evaluator类的do_apply(…)函数以及类似代码中，在删除订单对象后，不再需要调用数据库类的check_call_orders(…)函数。

## 讨论 ##

[如果有，再添加]

## 股东总结 ##

[如果有，再添加]

## 版权 ##

本文档放置于公共域名下。

## 查看 ##

- [https://github.com/bitshares/bitshares-core/issues/606](https://github.com/bitshares/bitshares-core/issues/606)
- [https://bitsharestalk.org/index.php?topic=25926.0](https://bitsharestalk.org/index.php?topic=25926.0)

