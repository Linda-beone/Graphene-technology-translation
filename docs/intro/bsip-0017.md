原文链接：https://github.com/bitshares/bsips/blob/master/bsip-0017.md
译者：bt666

    BSIP:0017
    标题:全局清算后恢复比特资产
    作者:Peter Conrad
    状态:草案
    类型:协议
    创建:2016-10-27
    讨论:https://bitsharestalk.org/index.php/topic,23334.0.html
        https://github.com/cryptonomex/graphene/issues/664
    版权:公共域名

## 摘要 ##

比特股中的比特资产，即类bitUSD的与市场挂钩的资产(MPA)和预测市场(PM)可能遭受“全局清算”事件。全局清算后，该资产实际上就变得毫无用处。该BSIP提议对协议进行修改，以解决全局清算的问题，从而使受影响的资产能够“恢复”并再次使用。

## 动机 ##

与市场挂钩的资产，又名智能货币，在某种程度上预测市场是比特股区块链的核心功能之一，因此提供我们的USPs。

MPAs可能会遭遇“黑天鹅”事件。当最少抵押的空头头寸没有足够的抵押品以当前的价格回购借来的智能货币时，黑天鹅就会出现。接下来发生的事情是，MPA被标记为“清算价格”，定义为最少抵押得空头的抵押比率。所有空头头寸都是自动平仓的，方法是将收集足够的抵押品到结算池中，并将剩余部分支付给做空者。MPA持有者可以使用强制清算操作从结算池中获得他们的份额，以交换他们的MPAs。(实际上，目前有一个bug可以防止这种情况发生，但这就是它的工作方式。)

一个技术上非常相似的机制被用来解决PMs问题。在PM交易中，做空者和持有者都在赌某个特定事件的结果。一旦实际结果成为现实，PM就会通过设置清算价格来结算。

遭受黑天鹅的MPAs和被清算的PMs都已经死亡。它们仍然可以转账或交易，但它们不能再用于做空。最终，所有重要的持有者都将清算他们的头寸，并且还会留下一点剩余量，这些少量的头寸的价值将低于清除它们所需的费用。

允许在清算事件后恢复MPAs和PMs将大大提高这两种资产的有用性。增加有用性将有望促进它们被采用。

### 基本原理 ###

在全局清算后，相关单位的价值相对于底层资产是固定的。这意味着，以清算价格将任何金额的资产交换成底层资产不会对被交易资产的所有者造成财务上的损失。

恢复比特资产对整个网络是有利的。这就证明，只要避免对任何人造成经济损失，就有理由做出有利于网络的决定。在处理相关资产时，任何可接受的财务损失都必须在舍入误差的范围内。

在这方面，可以忽略“override\_transfer”权限，该权限通常管理发行商强制转账比特资产，目的是恢复资产。

## 详情 ##

### revive\_asset操作 ###

将引入一个新的操作来恢复资产。这个操作的费用应该会很高，因为它是计算密集型操作。

该操作只有一个参数，即要恢复的资产。

该操作需要资产发行商的签名。

该操作只能在以下条件下调用:

- 该资产具有settlement\_price，要么来自黑天鹅，要么来自asset\_global\_settle操作。请注意，这仅适用于MPAs和PMs。
- 全局清算事件至少发生在28天前。这个参数需要进一步讨论，见下文。

为了执行操作，将按照下面的描述查找和处理要恢复的资产的所有未结头寸。

### 打开头寸以及如何处理 ###

在接下来的章节中，SWAN是一种将要恢复的资产。BACK是资产支持SWAN。

**force\_settlement\_object**

强制清算有一个期限。在该日期之后，如果底层资产具有settlement\_price，则将取消它们。对于SWAN来说就是这种情况，所以在一段时间后这些会自动得到解决。因为“某个时间”可能很长，所以最好以更快的方式解决这个问题。

解决方案:在黑天鹅的时候全部执行。这是一个软分叉。

**limit\_order\_object**

限价单可以买卖SWAN。在卖出的情况下，该订单持有一定数量的SWAN。卖单必须被取消，以恢复资产。买单应该被取消，因为报价可能基于过时的信息。

解决方案:取消所有要出售的或要购买的资产等于SWAN的订单。对limit\_order\_object::price::quote::asset\_id添加索引，以加快查找速度。

**call\_order\_object**

当全局清算发生时，SWAN的追加就会得到解决。所以在恢复资产时这些都不存在。

然而，当SWAN作为抵押品时追加仍可能存在。假设DUCK是由SWAN支持的资产。关于DUCK的追加不能取消。

解决1:修改DUCK由BACK支持而不是SWAN。相应地修改所有DUCK的追加。从DUCK删除喂价。

决议二:强制清算DUCK。这将释放所有用作DUCK抵押品的SWAN，即SWAN将被返回到account\_balance对象中，并按照下面的描述进行解析。

请注意，方案2仅适用于MPAs，而不适用于PMs，因为PMs没有一个喂价可以用来确定DUCK和SWAN在解决方案中的公平价值。

还要注意，方案2是递归的——如果存在由SWAN支持的资产SLUG，那么SLUG也必须被清算。

这个解决方案需要进一步讨论。

**vesting\_balance\_object**

一个vesting\_balance\_object可以持有一个给定帐户的SWAN的授权余额。可采用不同的策略(线性或持币天数)授予余额。

解决方案:对于SWAN的每一个非零授权余额，创建(如果需要)一个对应授权政策的BACK授权余额，并相应地调整余额和政策参数。将对vesting\_balance\_object::asset::asset\_id添加索引以加速查找。

**balance\_object**

余额对象(不要与account\_balance对象混淆)包含创世余额，可能是线性授权的。这在BitShares-2.0中应该是罕见的情况，但它是可能的，需要得到解决。

解决方案:SWAN的所有余额都被等价的BACK余额所取代。将添加balance\_object::asset\_type上的索引以加速查找。

**blinded\_balance\_object**

盲余额是石墨烯隐身特性的一部分。一盲余额只有一个资产id，但是没有(可见的)金额。唯一可见的是该资产类型的所有盲余额的总和，这是资产动态数据中的一个字段。

解决方案:

1. settlement\_fund的一部分款项将用于结算盲余额。为此，将引入一个新的对象类型“blinded\_settlement\_object”，其中包含blinded\_settlement\_fund和剩余的总盲金额。
1. blinded\_balance\_object将接收一个额外的可选字段，该字段可能包含对blinded\_settlement\_fund的引用。具有这样一个引用的blinded\_balance只能与具有相同引用的其他blinded\_balance一起偿清，但不能再转账。注意:在这里的费用处理需要特别小心。必须避免使用盲余额和SWAN费用池。相反，必须使用BACK费用池(如果有的话)。
1. 在提现时，提取的金额立即从blinded\_settlement\_fund转到BACK。如果提取的金额等于剩余的盲金额，则将剩余的blinded\_settlement\_fund支付给提现者，并删除对象。

注意，pair(SWAN, blinded\_settlement\_object)创建了一种虚拟资产，不应该通过现有的用户界面与“纯”SWAN 余额混合在一起。

将添加blinded\_balance\_object::asset\_id上的索引以加速查找。

**blinded\_settlement\_object**

此对象类型尚不存在。如前所述，它是由处理盲SWAN余额的机制引入的。

解决方案:持有SWAN的blinded\_settlement\_objects立即转换为BACK。

**account\_balance\_object**

这是账户的实际余额。每个这样的对象都指向一个特定的帐户和资产。SWAN的account\_balance可以通过强制清算功能随时转换为BACK。

解决方案:SWAN的账户余额立即转换为BACK。

**asset\_bitasset\_data\_object**

如果资产在全局清算中，此对象定义(以及其他内容)。

解决方案:

- 将剩余的settlement\_fund支付给发行商(如果有的话)
- 使settlement\_price / force\_settled\_volume无效
- 置空喂价list / unset current\_feed
- 置空options.whitelist\_authorities和set white\_list in options.flags

后者需要讨论。

**asset\_dynamic\_data\_object**

此对象记录现有的SWAN数量(总数和盲法)。它还包含费用池。

解决方案:将accumulated\_fees设置为0，并相应地调整current\_supply。发行商将通过接收settlement\_fund剩余资金来补偿损失的费用。在执行所有先前的方案后，current\_supply和confidential\_supply必须为0。

### 额外的更改 ###

**bug修复:遇到黑天鹅后的MPAs在喂价到期后无法得到清算**

事实证明，强制清算MPA需要一个有效的喂价，即使MPA具有settlement\_price集合。这显然是一个bug，因为在这种情况下，清算价格独立于喂价。此外，在黑天鹅事件之后，发布喂价就不可能了，所以可以清算的时间仅限于MPA的喂价的到期时间。

这需要修正。请参阅[https://github.com/cryptonomex/graphene/issues/664# issues ecomecom-254056746。](https://github.com/cryptonomex/graphene/issues/664#issuecomment-254056746)

**新的链参数:minimum\_time\_before\_asset\_revival**

这个参数定义了资产的全局清算事件和同一资产的恢复之间所需的最小时间。该参数可由委员会修改，默认为4周(28天)。请参阅下面的讨论。

**依赖MPAs**

如果在全局清算时存在由已清算资产支持的MPA，则依赖的MPA也将被清算。

此外，将禁止创建具有settlement\_price的比特资产所支持的资产。

原因在于，在全局清算后，已结算资产不再与“实际”资产挂钩。例如，假设存在一种资产bitGOLD\_USD，它应该表示一定数量的黄金的价值，并由一定数量的bitUSD(应该与美元挂钩)支持。bitUSD遭受“黑天鹅”之后，bitUSD不再与美元挂钩。相反，bitUSD表示固定数量的BTS，由settlement\_price定义。

据推测，bitGOLD\_USD的喂价将继续按照S-Dollars计算金价，这将很快偏离bitGOLD\_USD的实际价值，这实际上是由当时的BTS价格定义的。这将导致市场参与者的困惑和愤怒。因此，将bitGOLD\_USD放在与支持USD相同的中间状态是合理的。

这一变化需要进一步讨论。

## 讨论 ##

### minimum\_time\_before\_asset\_revival ###

全球清算和恢复的快速循环可能会导致资产用户(持有者和做空者)之间的混淆。滥用这个功能的可能性甚至是有限的。因此，在恢复之前强制一个最小时间是合理的，这样可以让用户了解资产的情况和影响他们的解决过程。

### 依赖资产 ###

如上所述，可能存在使用SWAN作为抵押的资产。必须以某种方式解决此类资产的空头头寸。提案的方案1相当苛刻，因为它修改了使用SWAN作为抵押品的资产。

这是合理的，因为SWAN有效地表示固定数量的BACK的值，这意味着由SWAN支持的资产实际上由BACK支持。提议的方案只明确了这一点。

在源代码中有一个相关的注释[(https://github.com/cryptonomex/graphene/blob/f1b19b15629cd02669a94f2af16eeaec7f54b3f6/libraries/chain/include/graphene/chain/protocol/asset\_ops.hpp#L160)](https://github.com/cryptonomex/graphene/blob/f1b19b15629cd02669a94f2af16eeaec7f54b3f6/libraries/chain/include/graphene/chain/protocol/asset\_ops.hpp#L160):

> 如果该资产被用作其他比特资产的担保，这些比特资产将被迫以当前价格清算。

这并没有反映在AFAICS的实际实现中。

欢迎提出更好的建议。

### 标识和许可 ###

如上所述，恢复操作将设置被恢复资产的白名单的标识和权限。这样做的目的是在发行商有机会修改其他资产参数之前，防止资产立即变为活动状态。例如，在恢复预测市场之后，所有者可能希望在开始下一轮预测之前更新资产描述。

### 受影响方 ###

**交易所**

持有SWAN的交易所会像其他人一样将其SWAN交换为BACK。该交易所的内部账簿中可能会有SWAN余额，它们属于交易所的用户。交易所必须被通知清算，它必须修改其内部分账簿，用BACK余额代替SWAN余额。

交易所执行这个操作应该独立于恢复操作，即在恢复被触发之前。他们可以通过强制清算自己的SWAN资产来做到这一点。

**（其他）用户**

持有SWAN的用户将会在settlement\_price上用等价的BACK替换他们所持有的SWAN。这不会对持有者带来经济上的损失，见上文。

**资产所有者**（aka发行商）

要恢复的资产的发行商应该知道他在做什么。调用revive\_asset操作是一种故意的行为。如果他对操作的效果不满意，他就不应该调用它。

被恢复资产支持的资产发行商也会受到影响，但他们别无选择。参见上面关于依赖资产的讨论。

## 总结 ##

该提案讨论了一系列将“动不了的”资产恢复到可用状态的更改。

并非所有股东都需要了解提案的技术细节，不过他们应该了解这些更改的影响。尤其重要的是要了解资产的恢复如何影响不同的各方，即持有人、做空者、交易商和发行人。

在一SWAN支持的资产出现全局清算后，为了恢复该资产，所有现存的SWAN都必须被销毁，而且它们的所有者必须获得可用抵押品的一部分(BACK)。特别是,

1. 在黑天鹅发生时，将完成所有未完成的清算请求，所有由SWAN支持的MPAs也将被全局清算。
1. 在恢复资产时，所有关于SWAN的开放市场订单将被取消(买卖)。
1. 由SWAN支持的其他MPAs也将被清算。
1. 其他由SWAN支持的PMs将被修改，以便它们有BACK支持。
1. SWAN的授权余额、创世余额和账户余额将相应地转换为BACK余额。
1. SWAN的盲余额将会得到特殊处理，这样它们就可以作为BACK提现。
1. SWAN费用池将归零，发行商将获得剩余的BACK抵押品。
1. 最后，SWAN将进入一个状态，在这种状态下，发行商可以修改参数，并最终将其开放给大众再次使用。