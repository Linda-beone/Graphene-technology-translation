  **原文链接**：[https://github.com/bitshares/bsips/blob/master/bsip-0032.md](https://github.com/bitshares/bsips/blob/master/bsip-0032.md)
 
 **译者**：[https://github.com/b-t-s-1](b-t-s-1)
 
 **校对者**： 
  
***

    BSIP: 0032
    标题: 始终按挂单价格匹配订单
    作者: Abit More <https://github.com/abitmore>
    状态：已安装
    类型：协议
    创建时间: 2018-02-16
    讨论: https://github.com/bitshares/bitshares-core/issues/338
    替代: -
    工人: 1.14.93

# 摘要

目前，在大多数情况下，当匹配两个订单时，挂单的价格将用于计算每个订单将支付和接收的金额。
但是，当将吃单限价订单与挂单保证金追订单匹配时，吃单价格被会使用。

该BSIP提出了一个原则：始终按照挂单价格匹配订单。

# 动机

通常，先前下达的订单（挂单）设定价格，稍后放置的另一个订单（吃单）接受价格，因此匹配，两个订单以该价格相互支付。

以BitShares中的纯限制顺序匹配机制为例：如果一个人（A）设置了限价了以每个BTS 0.1美元的价格出售100个BTS，另一个人（B）然后放置一个新的限价购买100 BTS，每个BTS 0.105美元，这两个订单将匹配每个BTS 0.1美元，所以A将支付100 BTS并获得10美元，B将支付10美元和获得100个BTS。

但是，在BitShares中，将吃单限价订单与挂单保证金匹配订单时，吃单价格被使用。例如，如果交易者A的保证金要求是每个BTS以不低于0.1美元的价格出售100个BTS，然后交易者B下了订单按每个BTS 0.105美元购买100个BTS，两个订单将匹配0.105美元每个BTS，所以A将支付100 BTS并获得10.5 USD，B将支付10.5 USD并获得100 BTS。

虽然不是严格意义上的错误，但这种行为对于用户来说是出乎意料和恼人的。

# 合理性

以挂单价格匹配订单，在订单簿上在内部追加保证金，是一个易于理解的规则，符合用户的期望，见bitshares-core issue ＃338。

喂价中有一个名为MSSR的参数，代表“轧空比率“。保证金通知单的吃单价格是MSSP，代表“轧空保护价”，计算为“喂价/轧空比率”。注意：这里的'喂价`就债务/抵押品而言，即“每股债务多少抵押”。

目前，当订单以最小抵押比率低于100％抵押品比率价格（将其命名为“100CRP”）时，将发生黑天鹅事件。因为发起订单序将与进来的限价订单以限价订单的价格（吃单价格）匹配，可以高于或低100CRP，所以即使MSSP低于100CRP，接收的吃单限价订单可能会也可能不会触发黑天鹅。因此，当一个限价订单创建时，每次检查是否会发生黑天鹅事件是有意义的。

在行为更改为始终与挂单价格匹配后，当MSSP低于此时100CRP，传入的吃单限限价订单将始终触发黑天鹅事件。因此，当MSSP低于100CRP时触发黑天鹅事件是有意义的而不是等待传入的限价订单。 这意味着它不再存在在创建限价订单时需要检查黑天鹅事件。由于检查黑天鹅事件在某种程度上是昂贵的，通过变更我们将获得一收益。

# 技术规范

限价订单和发起订单之间的匹配是在`database`类的`check_call_orders（...）`，限价订单的价格总是被使用。 当发起订单是吃单时，需要将其更改为使用MSSP。

当MSSP低于100CRP时触发黑天鹅事件时，有时最低抵押比率的空头头寸可能仍然有超过100％的抵押品比。 在这种情况下，全球结算价格为100CRP，但不是实际价格空头头寸的抵押品比率与抵押品最低比率。这是当前的行为，这是公平的，无需改变。

# 讨论

即使传入的订单指定了更好的价格，在空头匹配MSSP时，看起来也是不公平的。但是，在理性行动的市场中，用户不会，在存在追加保证金的情况下，在MSSP下创建限价单。实际上，新规则不会改变这种情况。

# 股东摘要

[待添加]

# 版权所有

本文档位于公共域。

# 也可以看看

* https://github.com/bitshares/bitshares-core/issues/338
* https://bitsharestalk.org/index.php?topic=25926.0
